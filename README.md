# Bot Kenmart - Архитектура

## Описание
Telegram бот для управления сменами и заданиями сотрудников. Код разбит на логические модули для удобства разработки и поддержки.

## Структура проекта

```
bot_kenmart/
├── src/                          # Основной код
│   ├── config/                   # Конфигурация и настройки
│   │   ├── __init__.py
│   │   └── settings.py          # Токены, константы, глобальные переменные
│   ├── database/                 # Работа с базой данных
│   │   ├── __init__.py
│   │   └── sql_client.py        # SQL клиент
│   ├── handlers/                 # Обработчики команд и сообщений
│   │   ├── __init__.py
│   │   ├── auth_handlers.py     # Авторизация пользователей
│   │   ├── shift_handlers.py    # Управление сменами
│   │   ├── task_handlers.py     # Управление заданиями
│   │   └── zs_handlers.py       # Обработчики для заведующих
│   ├── keyboards/                # Клавиатуры
│   │   ├── __init__.py
│   │   ├── auth_keyboards.py    # Клавиатуры авторизации
│   │   ├── opv_keyboards.py     # Клавиатуры для ОПВ
│   │   └── zs_keyboards.py      # Клавиатуры для ЗС
│   ├── utils/                    # Вспомогательные функции
│   │   ├── __init__.py
│   │   ├── time_utils.py        # Функции для работы со временем
│   │   └── task_utils.py        # Функции для работы с заданиями
│   ├── scheduler/                # Планировщики задач
│   │   ├── __init__.py
│   │   └── task_scheduler.py    # Автоматическое назначение заданий
│   ├── __init__.py
│   └── main.py                  # Главный файл с регистрацией обработчиков
├── main.py                      # Точка входа (запуск: python main.py)
├── bot_kenmart 2.py            # Исходный файл (для справки)
├── kidou_s.py                   # Модуль SQL запросов
└── README.md                    # Этот файл
```

## Модули

### config/
- **settings.py** - все константы, токены и глобальные переменные

### database/
- **sql_client.py** - инициализация SQL клиента

### handlers/
- **auth_handlers.py** - авторизация и регистрация пользователей
- **shift_handlers.py** - управление сменами (начало, конец, выбор роли)
- **task_handlers.py** - получение, выполнение и завершение заданий
- **zs_handlers.py** - функционал для заведующих (просмотр ОПВ, проверка заданий)

### keyboards/
- **auth_keyboards.py** - клавиатуры для авторизации и выбора смены
- **opv_keyboards.py** - клавиатуры для операторов
- **zs_keyboards.py** - клавиатуры для заведующих

### utils/
- **time_utils.py** - функции для работы со временем и слотами
- **task_utils.py** - вспомогательные функции для заданий

### scheduler/
- **task_scheduler.py** - автоматическое назначение заданий по расписанию

## Запуск

```bash
python main.py
```

## Временные слоты

### Дневная смена
- **Слот 1**: 08:00 - 10:30
- **Слот 2**: 10:30 - 13:30  
- **Слот 3**: 13:30 - 16:30
- **Слот 4**: 16:30 - 20:00

### Ночная смена
- **Слот 5**: 20:00 - 00:00
- **Слот 6**: 00:00 - 03:00
- **Слот 7**: 03:00 - 05:00
- **Слот 8**: 05:00 - 08:00

## Особенности архитектуры

1. **Модульность** - каждый функционал вынесен в отдельный модуль
2. **Разделение ответственности** - обработчики, клавиатуры и утилиты разделены
3. **Конфигурация** - все настройки централизованы в одном месте
4. **Импорты** - четкая структура импортов между модулями
5. **Сохранение функционала** - все имена функций, команд и callback'ов остались без изменений

## Миграция

Старый файл `bot_kenmart 2.py` сохранен для справки. Новый код полностью совместим по функционалу, но имеет улучшенную архитектуру.



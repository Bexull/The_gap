# Исправления от 2025-09-30

## Исправление критической ошибки в get_task_remaining_time

**Проблема:** Функция возвращала `remaining_seconds` (оставшееся время) как `total_seconds`, но в `update_timer` этот параметр используется как `allocated_seconds` (выделенное время). 

**Проблема:** При разморозке задания, если `frozen_tasks_info` был очищен, функция возвращала полное время задания (30 минут), и таймер начинался заново с 30:00 вместо продолжения с оставшегося времени (например, 09:15).

**Решение:** Изменена логика `get_task_remaining_time` в `src/utils/task_utils.py`:
- Теперь функция возвращает `allocated_seconds` (полное выделенное время) вместо `remaining_seconds`
- При наличии `frozen_tasks_info` используется сохраненный `allocated_seconds`, а не `remaining_seconds`
- Добавлено логирование для отладки восстановления времени задания

**Результат:** Это исправление гарантирует, что таймер всегда продолжит работу с правильного момента после разморозки задания.

---

## Улучшение логирования таймера

**Проблема:** В логах показывался переход `None -> 29:00` при первом обновлении таймера, что создавало путаницу.

**Решение:** Убрано логирование первого обновления таймера с `None -> XX:XX` в `src/handlers/task_handlers/task_timer.py`.

**Результат:** 
- Теперь в логах не будет показываться переход `None -> 29:00`, что убирает путаницу и делает логи более информативными
- Логирование происходит только при реальном изменении отображаемого времени (например, `29:00 -> 28:45`)

---

## Исправление критической ошибки при заморозке заданий

**Проблема:** При заморозке задания через `_handle_freeze_state` происходило удаление `task_time_tracker`, а затем `stop_timer_for_task` перезаписывал `frozen_tasks_info` с `elapsed_seconds = 0`, что приводило к показу полного времени задания (30:00) вместо оставшегося времени (9:15) при восстановлении.

**Решение:** Добавлена проверка в `stop_timer_for_task`: если данные уже сохранены в `frozen_tasks_info` (например, из `_handle_freeze_state`), не перезаписывать их. Это предотвращает потерю информации о прошедшем времени при заморозке.

**Результат:** Теперь при восстановлении задания таймер корректно показывает оставшееся время вместо полного времени задания.
